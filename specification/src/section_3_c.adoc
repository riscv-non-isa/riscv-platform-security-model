[[section_3_c]]
=== Isolation and Trusted Execution [Ravi Sahita]

Complex systems include software components from different supply chains, and complex integration chains with different roles and actors. Isolation models enable separation of mutually distrusting software ecosystems executing on a hart so that they can be developed, certified, deployed and attested independently of each other with only a minimal shared trusted base.  

==== Risc-V Isolation Building Blocks  [Nicholas Wood, Ravi, Nick]

===== PMP and ePMP

https://github.com/riscv/riscv-isa-manual/releases/tag/Priv-v1.12[Privileged ISA]

PMP provides physical memory protection for machine mode. Physical memory can be divided into regions, and each region assigned access criteria for user mode. This enables M-mode to control physical memory access from supervisor mode. Machine mode by default can access all memory. Access rules can be locked until the next system reset to create temporal isolation boundaries, such as protecting immutable boot code. Or access rules can be dynamic, allowing machine mode to manage supervisor mode access rules at runtime.

ePMP extends PMP protection by allowing machine mode to restrict its own access to memory allocated to supervisor mode. In particular preventing machine mode from executing from or accessing memory allocated to supervisor mode. This can be used to mitigate against privilege escalation attacks, for example.

[width=100%]
[%header, cols="5,20"]
|===
| ID#     
| Requirement

| CAT_NNN  
| If PMP is supported then ePMP MUST be supported.
|===

===== sPMP

sPMP provides physical memory protection for supervisor mode. Supervisor physical memory, as defined by PMP access rule, can be divided into regions and each region assigned access criteria for user mode. Supervisor mode by default can access any supervisor physical memory, but supervisor mode can restrict its own access to memory assigned to user mode (similar to ePMP).

sPMP can also be used on systems supporting the H-extension. In this case a hypervisor (HS mode) controls a base sPMP configuration controlling guest physical memory accesses (VS mode). Guests can in turn control their own virtual sPMP configurations for lower privilege levels within the guest. This can support, for example, static partition hypervisors.

===== MTT

===== Hypervisor extension

https://github.com/riscv/riscv-isa-manual/releases/tag/Priv-v1.12[Privileged ISA]

The hypervisor extension adds new privilege levels in support of hypervisor based systems. Supervisor mode is split into an HS mode hosting a hypervisor, and a VS mode (virtual supervisor mode) hosting guests.

===== MMU

===== IOPMP

===== IOMMU

===== Supervisor domains

[discrete]
Overview

[discrete]
SDID

[discrete]
Interrupts

[discrete]
Performance counters

[discrete]
External debug

[discrete]
Self-hosted debug


==== Example use case: Basic Non-virtualized system

*Overview*

*Isolation model*

*Device access control*

*Sealing*

*Attestation*


==== Example use case: Basic virtualized system

*Overview*

*Isolation model*

*Device access control*

*Sealing*

*Attestation*

==== Example use case: Global Platform TEE [Nicholas Wood]

*Overview*

[caption="Figure {counter:image}: ", reftext="Figure {image}"]
[title= "Non-virtualised TEE example.", id=non-virtualised-tee]
image::img_3_c_non-virtualised-tee.png[]

[caption="Figure {counter:image}: ", reftext="Figure {image}"]
[title= "Virtualised TEE example.", id=virtualised-tee]
image::img_3_c_virtualised-tee.png[]

*Isolation model*

*Device access control*

*Sealing*

*Attestation*


==== Example use case: Confidential Computing (Cove) [Nicholas Wood, Ravi Sahita]

*Overview*

[caption="Figure {counter:image}: ", reftext="Figure {image}"]
[title= "Cove example.", id=cove]
image::img_3_c_cove.png[]

*Isolation model*

*Device access control*

IOMTT IOMMU (IOPMP)

*Trusted device assignment*
TDPS APTEE-IO

*Attestation*

Layered attestation (6.2.2)
*Sealing*

Layered sealing (local/remote provisioning)





==== Additional examples

For reference, not detailed here (variations of the above).

* Android pKVM
